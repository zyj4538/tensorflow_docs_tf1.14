# Обновите код до TensorFlow 2.0

TensorFlow 2.0 включает много изменений API, таких как изменение порядка
аргументов, переименование символов и изменение значений по умолчанию
параметров. Выполнение этих модификаций вручную утомительно и подвержено
ошибкам. Для упрощения изменений и как можно более плавного перехода на TF 2.0,
команда TensorFlow создала утилиту `tf_upgrade_v2`, помогающую перейти от
устаревшего кода к новому API.

Утилита `tf_upgrade_v2` добавляется автоматически с `pip install` TF 2.0. Она
ускорит процесс обновления за счет преобразования существующих скриптов
TensorFlow 1.x Python в TensorFlow 2.0.

Скрипт обновления автоматизирует максимум возможного, но все еще есть
синтаксические и стилистические изменения, которые не могут быть выполнены
скриптом.

## Модуль совместимости

Некоторые символы API не могут быть обновлены просто с помощью замены строки.
Чтобы гарантировать поддержку вашего кода в TensorFlow 2.0, скрипт обновления
включает в себя модуль `compat.v1`. Этот модуль заменяет TF 1.x символы
наподобие `tf.foo` их эквивалентами `tf.compat.v1.foo`. Хотя модуль
совместимости хорош, мы рекомендуем вам вручную вычитать замены и перенести их
на новые API в пространстве имен `tf. *` вместо пространства имен `tf.compat.v1.
*`.

Из-за устаревания модулей TensorFlow 2.x (например, `tf.flags` и`tf.contrib`)
некоторые изменения не могут быть отработаны путем переключения на `compat.v1`.
Обновление этого кода может потребовать использования дополнительной библиотеки
(например, «absl.flags») или переключения на пакет в
[tenorflow / addons](http://www.github.com/tensorflow/addons).

## Скрипт обновления

Чтобы конвертировать ваш код из TensorFlow 1.x в TensorFlow 2.x, следуйте
следующим инструкциям:

### Запустите скрипт из пакета pip

Сперва с `pip install` установите пакет `tensorflow==2.0.0-beta0` или
`tensorflow-gpu==2.0.0-beta0`.

Примечание: `tf_upgrade_v2` устанавливается автоматически для TensorFlow 1.13 и
выше (включая ночные сборки TF 2.0).

Скрипт обновления может быть запущен на одном файле Python:

```sh
tf_upgrade_v2 --infile tensorfoo.py --outfile tensorfoo-upgraded.py
```

Скрипт выведет ошибки если он не сможет найти исправление для кода. Вы также
можете запустить его на дереве каталогов:

```
# обновите файлы .py и скопируйте все остальные файлы в outtree
tf_upgrade_v2 --intree coolcode --outtree coolcode-upgraded

# обновление только .py файлов
tf_upgrade_v2 --intree coolcode --outtree coolcode-upgraded --copyotherfiles False
```

## Детальный отчет

Скрипт также сообщает список детальных изменений, например:

```
'tensorflow/tools/compatibility/testdata/test_file_v1_12.py' Line 65
--------------------------------------------------------------------------------

Added keyword 'input' to reordered function 'tf.argmax'
Renamed keyword argument from 'dimension' to 'axis'

    Old:         tf.argmax([[1, 3, 2]], dimension=0))
                                        ~~~~~~~~~~
    New:         tf.argmax(input=[[1, 3, 2]], axis=0))

```

Вся эта информация добавляется в файл`report.txt`, который будет экспортирован в
вашу текущую папку. После выполнения `tf_upgrade_v2` и экспорта вашего
обновленного скрипта, вы можете запустить модель и убедиться, что результат
аналогичен TF 1.x.

## Предостережения

-   Не обновляйте части вашего кода вручную до запуска этого скрипта. В
    частности, функции, поменявшие порядок аргументов, такие как `tf.argmax` или
    `tf.batch_to_space` вынудят скрипт неправильно добавить имена аргументов,
    что приведет к ошибкам в существующем коде.

-   Скрипт предполагает что `tensorflow` импортирован с использованием `import
    tensorflow as tf`.

-   Этот скрипт не меняет аргументы. Вместо этого скрипт добавляет ключи
    аргументов к функциям, у которых изменится порядок аргументов.

-   Проверьте [tf2up.ml](http://tf2up.ml) для удобного инструмента обновления
    файлов в форматах Jupyter Notebook и Python в репозитории GitHub.

Чтобы сообщить об ошибках в скрипте обновления или отправить запрос на
добавление новых функций, отправьте сообщение об ошибке на
[GitHub](https://github.com/tensorflow/tensorflow/issues). И если вы тестируете
TensorFlow 2.0, мы хотим услышать об этом! Присоединяйтесь к сообществу
[TF 2.0 Testing](https://groups.google.com/a/tensorflow.org/forum/#!forum/testing)
и отправляйте вопросы и обсуждения на сайт
[testing@tensorflow.org](mailto:testing@tensorflow.org).
